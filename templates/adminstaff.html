<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff & Caretaker Directory - Smart Hostel</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styleadminhome.css') }}">
</head>

<body>

<div class="app">

    <aside class="sidebar">
        <div class="brand">
            <div class="logo">üè¢</div>
            <div>
                <h1>Smart Hostel</h1>
                <p>Management View</p>
            </div>
        </div>

        <nav>
            <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a href="{{ url_for('admin_issues') }}">Issues</a>
            <a class="active" href="{{ url_for('admin_staff') }}">Staff</a>
            <a href="{{ url_for('admin_announcements') }}">Announcements</a>
        </nav>

        <div class="settings">
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </aside>

    <main class="main">

        <header class="topbar">
            <h2>Staff Directory</h2>

            <input type="text" placeholder="Search staff by name or role...">

            <div class="profile">
                <p class="name">Admin</p>
                <div class="avatar"
                     style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuD_AlTK4xY0kmCVsHrXS147JtJZem2mlC2K_cmOyO7Tb8pHpDmD1uEWETqJmY_t_8XOV0_Oh6VKtwcD0dirsms-p9MX2KxCJvnP36yfB76n8Bam_HsaNKTjIiwuYrSV2UHofq-oOqHQYBgd3toriijxRuOIYAkDZ8B7F-bBw40arP20K-dJEAgqtr4t-51_oZssGnzH-SZig4Az8-5KJvh1QrXJYFRopoyXr-5xHYUlKqddlRrNRFDTTwQ6jUFR-heJFv6VoAsw9w8');">
                </div>
            </div>
        </header>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash-container">
                    {% for message in messages %}
                        <div class="flash-error">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <section class="kpis">
            <div class="card">
                <h4>Total Staff</h4>
                <h2>{{ total_staff }}</h2>
            </div>

            <div class="card">
                <h4>Free Now</h4>
                <h2>{{ free_staff }}</h2>
            </div>

            <div class="card">
                <h4>Active Tasks</h4>
                <h2>{{ active_tasks }}</h2>
            </div>
        </section>

        <section class="cards">

            <div class="card add-card">
                <a href="/admin/staff/add">
                    <span class="material-symbols-outlined">add_circle</span>
                    <p>Add New Staff Member</p>
                </a>
            </div>

            {% for member in staff %}
                <div class="card">
                    <div class="card-body">

                        <div class="card-header">
                            <div class="profile">
                                <div class="avatar"
                                     style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuDQslz0ZEvWlNIRilUgYpBr1ilGd1LdkXvHOceyzgACN6lhQSV5S4jmTeNTt06eBL_ou_aiMr2_oQx_KDAP_33CvtJyo1GWk-SIx32wpZtrb9S1nA_MPtlG3She23lbW7h_-U8m0hMEgvbw70FVn8BtnuxtXIZ8_Rs-v1UTH2oVHpp7k47Sod0IauKRCljIC_tJn16ziNq2P0A6JROfYHmJ8Huaji8Db1jVQARB8yz-EK-AXZLwoCsCHkl4dLAMAmt1N3ofjW6pJl2j');">
                                </div>
                                <div>
                                    <h4>{{ member.name }}</h4>
                                    <p>{{ member.designation }}</p>
                                </div>
                            </div>

                            {% if member.active_tasks == 0 %}
                                <span class="status available">Available</span>
                            {% else %}
                                <span class="status busy">Busy</span>
                            {% endif %}
                        </div>

                        <div class="metrics">
                            <div>
                                <small>Active Tasks</small>
                                <strong>{{ member.active_tasks }}</strong>
                            </div>
                            <div>
                                <small>Phone</small>
                                <strong>{{ member.phone }}</strong>
                            </div>
                        </div>

                    </div>

                    <div class="card-footer">
                        <a href="{{ url_for('assign_tasks', staff_id=member.id) }}">
                            <button class="assign">Assign Task</button>
                        </a>

                        <a href="tel:{{ member.phone }}">
                            <button class="icon">üìû</button>
                        </a>

                        <form method="POST"
                              action="{{ url_for('delete_staff', staff_id=member.id) }}"
                              onsubmit="return confirm('Are you sure you want to delete this staff member?');">
                            <button type="submit" class="icon">üóë</button>
                        </form>
                    </div>
                </div>
            {% endfor %}

        </section>

        <section class="table-section">
            <h3>Recently Assigned Tasks</h3>

            <table>
                <thead>
                    <tr>
                        <th>Sr.No.</th>
                        <th>Assigned To</th>
                        <th>Category</th>
                        <th>Status</th>
                        <th>Elapsed</th>
                    </tr>
                </thead>

                <tbody>
                    {% for issue in active_issues %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ issue.staff_name }}</td>
                            <td>{{ issue.category_name or '‚Äî' }}</td>
                            <td>{{ issue.status }}</td>
                            <td>{{ issue.created_at | elapsed_time }}</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5">No Assigned Task</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

    </main>

</div>

</body>
</html>
